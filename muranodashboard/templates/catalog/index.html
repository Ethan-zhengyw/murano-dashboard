{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load custom_filters %}

{% block title %}{% trans "Environments" %}{% endblock %}

{% block page_header %}

<link rel="stylesheet" href="{% static 'muranodashboard/css/catalog.css' %}">
  {% include "horizon/common/_page_header.html" with title=_("Application Catalog") %}
{% endblock page_header %}

{% block js %}
    {% include "horizon/_scripts.html" %}

    <script type="text/javascript">
    var allPanelIds = ['#MuranoCategoriesPanel', '#MuranoSearchPanel',
        '#MuranoDefaultEnvPanel'];
    function bindPanelToggle(panelId) {
        var toggler = $(panelId + 'Toggle'), panel = $(panelId);
        toggler.click(function(event) {
            panel.css('top', toggler.offset().top);
            panel.toggleClass('panel-visible');
            allPanelIds.forEach(function(panId) {
                if ( panId != panelId ) {
                    $(panId).removeClass('panel-visible');
                    $(panId + 'Toggle').removeClass('active');
                }
            });
            toggler.toggleClass('active');
        })
    }
    $(function() {
        bindPanelToggle('#MuranoCategoriesPanel');
        bindPanelToggle('#MuranoSearchPanel');
        bindPanelToggle('#MuranoDefaultEnvPanel');
    })
    </script>
{% endblock %}

{% block main %}
<div class="table_wrapper">
<h3>Latest Apps</h3>
<div class="app-row app-list">
    {% for app in latest_list %}
       <div class="span4">
        <div class="well app">
            <div class="app-icon pull-left">
               <img src="{% url 'horizon:murano:catalog:images' app.image %}"/>
            </div>
            <div class="app-summary">
                <h4>{{ app.title }}</h4>
                <p>{{ app.description }}</p>
            </div>
            <div class="app-actions">
            {% with class='btn btn-small btn-add ajax-modal' %}
                {% trans "Add" as label %}
                {% if environment %}
                    <a href="{% url 'horizon:murano:catalog:add' environment.id app.id %}" class="{{ class }}">{{ label }}</a>
                {% else %}
                    <a href="{% url 'horizon:murano:environments:create_environment' %}?next={% url 'horizon:murano:catalog:index' %}" class="{{ class }}">{{ label }}</a>
                {% endif %}
                <a href="{% url 'horizon:murano:catalog:application_details' app.id %}" class="btn-link pull-right">More info &raquo;</a>
            {% endwith %}
            </div>
            </div>
        </div>
    {% endfor %}
</div>
<h3>App Category: <div class="header dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">
    {{ current_category_name }}<b class="caret"></b></a>
  <ul class="dropdown-menu">
      {% for cat_slug, cat_name in categories.items %}
        <li><a tabindex="-1" href="
        {% url 'horizon:murano:catalog:index' cat_slug page_obj.number %}">
            {{ cat_name }}</a></li>
      {% endfor %}
  </ul>
</div>
</h3>

<div class="app-row app-list">
    {% for app in object_list %}
        <div class="span4">
            <div class="well">
                <div class="app-icon pull-left">
                    <img src="{% url 'horizon:murano:catalog:images' app.image %}"/>
                </div>
                <div class="app-summary">
                    <h4>{{ app.title }}</h4>
                    <p>{{ app.description }}</p>
                </div>
                <div class="app-actions">
                {% with class='btn btn-small btn-add ajax-modal' %}
                    {% trans "Add" as label %}

                {% if environment %}
                    <a href="{% url 'horizon:murano:catalog:add' environment.id app.id %}" class="{{ class }}">{{ label }}</a>
                {% else %}
                    <a href="{% url 'horizon:murano:environments:create_environment' %}?next={% url 'horizon:murano:catalog:index' %}" class="{{ class }}">{{ label }}</a>
                {% endif %}
                <a href="{% url 'horizon:murano:catalog:application_details' app.id %}" class="btn-link pull-right">More info &raquo;</a>
                {% endwith %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% if is_paginated %}
    <div class="btn-toolbar centering">
      <div class="btn-group">
          {% if page_obj.has_previous %}
           <a class="btn btn-default"
              href="
              {% url 'horizon:murano:catalog:index' current_category page_obj.previous_page_number %}">
               Previous</a>
          {% else %}
           <a class="btn btn-default disabled" href="#">Previous</a>
          {% endif %}

          <a class="btn btn-default disabled"
             href="
             {% url 'horizon:murano:catalog:index' current_category page_obj.number %}">
              {{ page_obj.number }}</a>

          {% if page_obj.has_next %}
           <a class="btn btn-default"
              href="
              {% url 'horizon:murano:catalog:index' current_category page_obj.next_page_number %}">
               Next</a>
          {% else %}
           <a  class="btn btn-default disabled"  href="#">Next</a>
          {% endif %}
      </div>
    </div>
{% endif %}

<div class="murano-side-panel" id="MuranoDefaultEnvPanel">
      <div id="environment_switcher" class="dropdown switcher_bar"
       tabindex="1">
    {% with num_of_envs=available_environments|length %}
        {% if num_of_envs > 1 %}
            <a class="dropdown-toggle" data-toggle="dropdown" href="#environment_switcher">
        {% endif %}
        <h3 class="link">
            {% trans "Environment:" %}
            {% if environment %}
                {{ environment.name }}
            {% else %}
                <a href="{% url 'horizon:murano:environments:create_environment' %}?next={% url 'horizon:murano:catalog:index' %}" class="ajax-modal">{% trans "No Environments" %}</a>
            {% endif %}
           {% if num_of_envs > 1 %}
               <span class="caret"></span>
           {% endif %}
        </h3>
    {% if num_of_envs > 1 %}
        </a>
        <ul id="environment_list" class="dropdown-menu">
        <li class='divider'></li>
            {% for env in available_environments %}
            {% if env.id != environment.id %}
              <li><a href="{% url 'horizon:murano:catalog:switch_env' env.id %}?next={% url 'horizon:murano:catalog:index' %}">
                  {{ env.name }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
  </div>

</div>
<a class="trigger third" href="#" id="MuranoDefaultEnvPanelToggle">Environment</a>

<div class="murano-side-panel" id="MuranoCategoriesPanel">
    <h3>Categories</h3>

<div style="clear:both;"></div>
<div class="columns">
    <div class="colleft">
        <ul>
            {% for slug, category in categories.items|firsthalf %}
            <li><a href="#{{ slug }}">{{ category }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <div class="colright">
        <ul>
            {% for slug, category in categories.items|lasthalf %}
            <li><a href="#{{ slug }}">{{ category }}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>
</div>
<a class="trigger second" href="#" id="MuranoCategoriesPanelToggle">Category</a>

<div class="murano-side-panel" id="MuranoSearchPanel">
    <h3>Search</h3>
    <form class="search">
        <input class="text"/>
        <button class="btn_search">Go</button>
    </form>
</div>
<a class="trigger first" href="#" id="MuranoSearchPanelToggle">Search</a>
</div>

{% endblock %}
